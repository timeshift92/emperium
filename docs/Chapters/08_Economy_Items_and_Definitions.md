````markdown
# 08. Экономические товары и их определения

## Динамические товары
Экономика Imperium теперь поддерживает динамические товары. Список товаров хранится в `EconomyStateService` и может расширяться в рантайме через API.

Каждый товар имеет определение (метаданные), которые используются агентами экономики и другими сервисами для принятия решений:

- Name — уникальное имя товара
- BasePrice — базовая цена товара (используется как отправная точка для расчёта цен в `EconomyAgent`)
- Unit — единица измерения (kg, liter, unit и т.п.)
- ConsumptionPerTick — сколько единиц товара потребляется NPC за тик (можно использовать в `ConsumptionAgent`)
- Description, Tags — для UI и фильтрации

## API
 - `GET /api/economy/items` — возвращает список имён товаров
 - `POST /api/economy/items` — добавить массив имён (создаёт дефолты определений)
 - `GET /api/economy/item-defs` — получить все определения товаров
 - `GET /api/economy/item-defs/{name}` — получить определение товара
 - `POST /api/economy/item-defs` — создать/обновить определение товара (полный объект JSON)

Пример тела POST `/api/economy/item-defs`:

```json
{
  "name": "grain",
  "basePrice": 10.0,
  "unit": "kg",
  "consumptionPerTick": 0.5,
  "description": "Основной продукт питания",
  "tags": ["food", "staple"]
}
```

## Базовое наполнение (сид-список)
- В `src/Imperium.Api/appsettings.json` хранится секция `Economy.Items` — сейчас туда включено ~100 стартовых товаров (продовольствие, сырьё, ремесленные изделия, роскошь, транспорт и т.д.).
- При запуске API `EconomyStateService` подтягивает этот список и автоматически создаёт дефолтные определения (если в БД ещё нет явно заданных значений).
- При необходимости можно расширять сид-список напрямую в `appsettings.json` либо через `POST /api/economy/items`.

## Новые поля определений
В рамках текущей итерации `EconomyItemDefinition` расширена следующими полями, которые уже используются в сервисах и виджете экономики:

- `weightPerUnit` — вес единицы товара (кг)
- `perishableDays` — срок годности в днях (null → не портится)
- `stackSize` — максимальный размер стопки/пачки
- `category` — категория товара (food, raw, material и т.п.)

Эти поля валидируются на API‑уровне при `POST /api/economy/item-defs` (проверка >0 для вес/стека и >=0 для `perishableDays`).

## Использование в агентах
 - `EconomyAgent` использует `BasePrice` как исходную цену при генерации цен по локациям
 - `ConsumptionAgent` использует `ConsumptionPerTick` для расчёта дефицита/излишков
 - `ProductionAgent`/`MarketAI` могут использовать `Unit`/`tags` для фильтрации и агрегации

## Дальнейшие предложения
 - Добавить свойства: `weight`, `perishableDays`, `stackSize`, `category`.
 - Расширить UI (EconomyPanel) для управления определениями и просмотра прогнозов спроса.
 - Dev: API и агенты уже поддерживают базовые атрибуты; расширение полей и UI запланировано и должно включать миграции/тесты.

## UI: панель определений товаров
Добавлена простая панель `ItemDefsPanel` в `EconomyPanel`, позволяющая просматривать, создавать и редактировать определения товаров через REST API. Панель пока минимальная — планируются доработки: автозаполнение тегов, валидация форм и UX улучшения.

## Сделано
- Реализована серверная модель `EconomyItemDefinition` с расширенными полями.
- Добавлены проверки в API для новых полей.
- Добавлена простая панель управления определениями товаров в UI (`ItemDefsPanel`).

````
