
# üß† Copilot SWE Task ‚Äî World Genesis Initialization

## üéØ Goal
Implement **World Genesis** initialization logic for Imperium Universe (v4)
and extend the `Location` model with a cultural attribute.

The feature should create the **First World of Imperium I Epoch** automatically
when the database is empty.

---

## üß© Architecture Context
Project structure (Aspire-style):
- `Imperium.Domain` ‚Äî domain models, agents, metrics
- `Imperium.Infrastructure` ‚Äî EF Core, setup, seeders
- `Imperium.Api` ‚Äî Minimal API, TickWorker, SignalR
- `Imperium.Llm` ‚Äî JSON-only LLM client

Database: SQLite (EF Core)
Tick interval: 30 seconds

---

## üèóÔ∏è Tasks

### 1Ô∏è‚É£ Extend Location model
File: `src/Imperium.Domain/Models/Location.cs`

Add a new property:
```csharp
// üèõ Cultural context (e.g. hellenic, tribal, nomadic, etc.)
public string Culture { get; set; } = "unknown";
```

Ensure all existing entity configurations remain compatible with EF Core migrations.

---

### 2Ô∏è‚É£ Create WorldGenesisService
File: `src/Imperium.Infrastructure/Setup/WorldGenesisService.cs`

Implement static class:
```csharp
public static class WorldGenesisService
{
    public static Task InitializeAsync(AppDb db, CancellationToken ct = default);
}
```

Logic:
1. If `WorldTime` table is empty ‚Äî create the First World.
2. Seed initial entities:
   - `WorldTime` (Tick=0, Year=1, Day=1, Hour=6)
   - `SeasonState` (spring, AvgTempC=18)
   - `WeatherSnapshot` (TempC=20, Wind=3.4, DayLength=13)
   - `EconomySnapshot` (basic resources & taxes)
   - `Locations`: –°–∏—Ä–∞–∫—É–∑—ã, –ú–µ—Å—Å–∞–Ω–∞, –ì—Ä–∞—Å—Ç–∞, –ö–∞–≥–∞–Ω—å—è, –ö–∞–º—Ç–∞–Ω–∞, –ö–µ—Ç–∞–º–∏–∫–æ—Å, –í–Ω–∏–ª–∞, –¢—Ä–æ—Å—Ç–∞, Visca
     - each with `Culture` (hellenic / tribal) and realistic population
   - `Factions`: –î–æ–º –°–∏—Ä–∞–∫—É–∑, –ø–ª–µ–º–µ–Ω–∞ –ö–∞–≥–∞–Ω—å–∏, –ì—Ä–∞—Å—Ç—ã, –ö–∞–º—Ç–∞–Ω—ã
   - `Characters`: –ê—Ä—Ö–æ–Ω—Ç –§–∏–ª–æ–º–∞—Ö, –í–æ–∂–¥—å –ö–∞—Ä–µ—Ç, –ñ—Ä–∏—Ü–∞ –ò–ª–∞—Ä–∏—è, –°—Ç–∞—Ä–µ–π—à–∏–Ω–∞ –î—Ä–∞–∫–æ–Ω
   - `NpcEssence`: Strength, Intelligence, Charisma, Vitality, Luck
   - `Buildings`: –∞–∫—Ä–æ–ø–æ–ª—å, —Ö—Ä–∞–º, –ø–ª–µ–º–µ–Ω–Ω–æ–π –∑–∞–ª
   - `KnowledgeFields`: –ê—Å—Ç—Ä–æ–Ω–æ–º–∏—è, –ö—É–∑–Ω–µ—á–Ω–æ–µ –¥–µ–ª–æ, –ù–∞–≤–∏–≥–∞—Ü–∏—è
   - `WorldChronicle`: –∑–∞–ø–∏—Å—å –æ –Ω–∞—á–∞–ª–µ I –≠–ø–æ—Ö–∏
   - `Rumor`: –¥–≤–∞ —Å–ª—É—Ö–∞ –æ –º–∏—Ñ–∞—Ö –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–µ
3. Save all entities and print console message:  
   `"–ú–∏—Ä Imperium I –≠–ø–æ—Ö–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!"`

---

### 3Ô∏è‚É£ Integrate into Program.cs
File: `src/Imperium.Api/Program.cs`

Before starting `TickWorker`, insert:
```csharp
await app.Services.CreateScope().ServiceProvider
    .GetRequiredService<AppDb>()
    .Database.MigrateAsync();

await WorldGenesisService.InitializeAsync(
    app.Services.CreateScope().ServiceProvider.GetRequiredService<AppDb>());
```

This ensures the world is seeded automatically on first launch.

---

## ‚úÖ Acceptance Criteria
- [ ] `Location` model contains `Culture` string property.
- [ ] When the project starts on a fresh database, it automatically generates:
  - Cities, factions, characters, resources, knowledge fields, and chronicle entry.
- [ ] Console output confirms: `–ú–∏—Ä Imperium I –≠–ø–æ—Ö–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!`
- [ ] Re-running the app does not duplicate data.
- [ ] `/api/time` endpoint returns the initialized world state.

---

## üí° Optional (future)
Add `GenesisAI` LLM-agent that generates mythic backstory for Epoch I  
(JSON response ‚Üí saved into `WorldChronicle`).

---

## üßæ References
- `Imperium.Infrastructure/Setup/DbSetup.cs`
- `Imperium.Domain.Models.Location`
- `Imperium.Domain.Models.WorldTime`
- `Imperium.Domain.Models.WorldChronicle`
- `Imperium.Api/Program.cs`
