
# ‚öôÔ∏è Copilot SWE Task ‚Äî Activate Core Simulation Agents

## üéØ Goal
Enable the **live simulation loop** in Imperium Universe so that the world begins to evolve automatically after creation.  
This task connects and expands the existing agents (`TimeAI`, `SeasonAI`, `EconomyAI`, `NpcAI`) to perform meaningful world updates every 30 seconds.

---

## üß© Architecture Context
Project structure (Aspire-style):
- `Imperium.Api` ‚Äî Minimal API + TickWorker (already implemented)
- `Imperium.Domain` ‚Äî agents and domain models
- `Imperium.Infrastructure` ‚Äî EF Core + SQLite
- `Imperium.Llm` ‚Äî JSON-based LLM client

Already implemented:
‚úÖ `TickWorker` (BackgroundService) ‚Äî runs world ticks every 30s  
‚úÖ `IWorldAgent` interface  
‚úÖ `ILlmClient` and JSON-only LLM prompts  
‚úÖ `SignalR` and SSE event streaming  

Missing: actual logic inside core simulation agents.

---

## üèóÔ∏è Tasks

### 1Ô∏è‚É£ Extend and activate `TimeAI`
File: `src/Imperium.Domain/Agents/TimeAI.cs`

Logic:
- Load current `WorldTime`
- Increment tick (`Tick += 1`)
- Every 2880 ticks ‚Üí advance `Day += 1`

````markdown

# ‚öôÔ∏è Copilot SWE Task ‚Äî Activate Core Simulation Agents

## üéØ Goal
–í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ü–∏–∫–ª —Å–∏–º—É–ª—è—Ü–∏–∏ (tick loop) –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã –º–∏—Ä–∞: TimeAI, SeasonAI, EconomyAI, NpcAI.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏ (–Ω–æ–≤–∞—è, –æ—á–∏—â–µ–Ω–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

1) –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `TimeAI` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–∫–∞, –ø–µ—Ä–µ—Ö–æ–¥ –¥–Ω—è/–≥–æ–¥–∞, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è `day_change` —Å–æ–±—ã—Ç–∏–π.
2) –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `SeasonAI` ‚Äî —Ä–∞—Å—á—ë—Ç —Å–µ–∑–æ–Ω–∞, —Å–æ–∑–¥–∞–Ω–∏–µ `WeatherSnapshot`, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è `season_change`.
3) –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `EconomyAI` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `EconomySnapshot`, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è market events.
4) –î–æ—Ä–∞–±–æ—Ç–∞—Ç—å `NpcAI` ‚Äî LLM-driven –∫—Ä–∞—Ç–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è NPC –∏ `npc_reply` —Å–æ–±—ã—Ç–∏—è.
5) –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–æ–≤ –≤ DI –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `TickWorker` –∑–∞–ø—É—Å–∫–∞–µ—Ç –∏—Ö –ø–æ –ø–æ—Ä—è–¥–∫—É.
6) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π (SignalR `/hubs/events`, SSE `/api/events/stream`).

---

## Acceptance criteria

- TickWorker –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞–≥–µ–Ω—Ç–æ–≤ –∫–∞–∂–¥—ã–µ 30s
- –í –ë–î —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–æ–±—ã—Ç–∏—è `day_change`, `season_change`, `market_event`, `npc_reply`
- –°–æ–±—ã—Ç–∏—è —Å—Ç—Ä–∏–º—è—Ç—Å—è –≤ `/hubs/events` –∏ `/api/events/stream`

---

## Dev commands

```pwsh
dotnet test src/Imperium.sln
dotnet ef database update --project src/Imperium.Infrastructure --startup-project src/Imperium.Api
``` 

---

## Notes

- –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–∏–≥—Ä–∞—Ü–∏–π: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `__EFMigrationsHistory` –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–∞–π–ª–æ–≤ –º–∏–≥—Ä–∞—Ü–∏–π.

````
Logic:
