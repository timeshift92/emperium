
# üåç Copilot SWE Task ‚Äî Nature & Tribes Genesis Initialization

## üéØ Goal
Extend Imperium Universe world generation after the First World Genesis by adding **nature ecosystems**, **resources**, and **early tribes** with their social and genetic identities.

This feature continues the initialization flow after `WorldGenesisService`, making the world feel alive with fauna, natural resources, and pre-civilization societies.

---

## üß© Architecture Context
Project structure (Aspire-style):
- `Imperium.Domain` ‚Äî domain models, agents, metrics
- `Imperium.Infrastructure` ‚Äî EF Core, setup, seeders
- `Imperium.Api` ‚Äî Minimal API, TickWorker, SignalR
- `Imperium.Llm` ‚Äî JSON-only LLM client

Database: SQLite (EF Core)
Tick interval: 30 seconds

---

## üèóÔ∏è Tasks

### 1Ô∏è‚É£ Create NatureGenesisService
File: `src/Imperium.Infrastructure/Setup/NatureGenesisService.cs`

Implement static class:
```csharp
public static class NatureGenesisService
{
    public static Task InitializeAsync(AppDb db, CancellationToken ct = default);
}
```

Logic:
1. Check if any `EconomySnapshot` or `WeatherSnapshot` records exist ‚Äî skip if already seeded.
2. Generate **biomes** for the world regions:
   - forest, plain, mountain, coast
3. Seed fauna and resources for each biome:
   ```json
   {
     "forest": {"deer": 120, "wolf": 30, "boar": 70},
     "mountain": {"goat": 90, "bear": 8},
     "coast": {"fish": 300, "crab": 40}
   }
   ```
4. Add entries into `EconomySnapshot` and `WeatherSnapshot`.
5. Create `GameEvent` with type `"nature_seed"` and summary `"–ü—Ä–∏—Ä–æ–¥–∞ –ø—Ä–æ–±—É–¥–∏–ª–∞—Å—å –ø–æ—Å–ª–µ —Å–æ—Ç–≤–æ—Ä–µ–Ω–∏—è –º–∏—Ä–∞."`.

---

### 2Ô∏è‚É£ Create TribesGenesisService
File: `src/Imperium.Infrastructure/Setup/TribesGenesisService.cs`

Implement static class:
```csharp
public static class TribesGenesisService
{
    public static Task InitializeAsync(AppDb db, CancellationToken ct = default);
}
```

Logic:
1. Check if `Faction` with type `"tribe"` already exists ‚Äî skip if yes.
2. Create 5‚Äì7 early tribes:
   - Each with distinct attributes: `bravery`, `faith`, `craftsmanship`
   - Assign to `Location` (mountain, plain, coast)
3. For each tribe:
   - Create 2‚Äì3 `Character` (chief, shaman, warrior)
   - Create `NpcEssence` (randomized genetics/traits)
   - Add small `Ownership` (land, livestock, tools)
   - Add `NpcMemory` and `Relationship` (alliances, rivalries)
4. Save all entities and log `"–ü–ª–µ–º–µ–Ω–∞ –ø–µ—Ä–≤–æ–π —ç–ø–æ—Ö–∏ –ø—Ä–æ–±—É–¥–∏–ª–∏—Å—å."`

---

### 3Ô∏è‚É£ Integration
In `src/Imperium.Api/Program.cs`, after:
```csharp
await WorldGenesisService.InitializeAsync(app.Services.CreateScope().ServiceProvider.GetRequiredService<AppDb>());
```
add:
```csharp
await NatureGenesisService.InitializeAsync(app.Services.CreateScope().ServiceProvider.GetRequiredService<AppDb>());
await TribesGenesisService.InitializeAsync(app.Services.CreateScope().ServiceProvider.GetRequiredService<AppDb>());
```

This ensures world initialization progresses from terrain ‚Üí nature ‚Üí tribes ‚Üí civilization.

---

## ‚úÖ Acceptance Criteria
- [ ] New `NatureGenesisService` creates fauna, resources, and climate data.
- [ ] New `TribesGenesisService` creates 5‚Äì7 early tribes, each with NPC, memory, and relationships.
- [ ] First launch generates sequential logs:
  - `[WorldGenesis] Created`
  - `[NatureGenesis] Created`
  - `[TribesGenesis] Created`
- [ ] Database reflects realistic biomes, animals, and tribal entities.
- [ ] Re-running app does not duplicate entities.

---

## üí° Optional (future)
Add `GenesisAI` LLM agent that generates the **creation myth** of Epoch I in structured JSON, for example:
```json
{
  "epoch_name": "I –≠–ø–æ—Ö–∞ –°–æ–ª–Ω—Ü–∞",
  "creation_myth": "–ö–æ–≥–¥–∞ —Å–≤–µ—Ç –Ω–µ–±–µ—Å –≤–ø–µ—Ä–≤—ã–µ –∫–æ—Å–Ω—É–ª—Å—è –∑–µ–º–ª–∏, –º–æ—Ä—è –∑–∞–∫–∏–ø–µ–ª–∏...",
  "tribal_origins": [
    {"name": "–ü–ª–µ–º—è –ö–∞–≥–∞–Ω—å–∏", "origin": "–∏–∑ –ø–µ–ø–ª–∞ –≤—É–ª–∫–∞–Ω–∞"},
    {"name": "–ü–ª–µ–º—è –ì—Ä–∞—Å—Ç—ã", "origin": "—É –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –≤–µ—á–Ω–æ–π –≤–æ–¥—ã"}
  ]
}
```
This JSON should be recorded into `WorldChronicle` as the mythic beginning of the First Era.

---

## üßæ References
- `Imperium.Infrastructure/Setup/WorldGenesisService.cs`
- `Imperium.Infrastructure/Setup/DbSetup.cs`
- `Imperium.Domain.Models.*`
- `Imperium.Api/Program.cs`
