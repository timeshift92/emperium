
# üèõ Copilot SWE Task ‚Äî Early Civilization Genesis

## üéØ Goal
Advance the Imperium Universe world from tribal age to **early civilization** stage.  
This phase introduces permanent settlements, trade, religion, and craftsmanship ‚Äî transforming tribes into proto-states.

---

## üß© Architecture Context
Project structure (Aspire-style):
- `Imperium.Domain` ‚Äî domain models, agents, metrics
- `Imperium.Infrastructure` ‚Äî EF Core, setup, seeders
- `Imperium.Api` ‚Äî Minimal API, TickWorker, SignalR
- `Imperium.Llm` ‚Äî JSON-only LLM client

Depends on previous initializers:
- ‚úÖ `WorldGenesisService`
- ‚úÖ `NatureGenesisService`
- ‚úÖ `TribesGenesisService`

Database: SQLite (EF Core)
Tick interval: 30 seconds

---

## üèóÔ∏è Tasks

### 1Ô∏è‚É£ Create `CivilizationGenesisService`
File: `src/Imperium.Infrastructure/Setup/CivilizationGenesisService.cs`

Implement static class:
```csharp
public static class CivilizationGenesisService
{
    public static Task InitializeAsync(AppDb db, CancellationToken ct = default);
}
```

#### Logic:
1. Skip if any `Faction` of type `"city_state"` already exists.
2. Transform 2‚Äì3 developed tribes into early city-states:
   - Example: ‚Äú–ü–ª–µ–º—è –ö–∞–≥–∞–Ω—å–∏‚Äù ‚Üí ‚Äú–ì–æ—Ä–æ–¥ –ö–∞–≥–∞–Ω—å—è‚Äù
   - Example: ‚Äú–ü–ª–µ–º—è –ì—Ä–∞—Å—Ç—ã‚Äù ‚Üí ‚Äú–ì–æ—Ä–æ–¥ –ì—Ä–∞—Å—Ç–∞‚Äù
3. For each:
   - Increase `Population` in `Location`
   - Create `Faction` type = `"city_state"`
   - Add simple economy: grain, metal, wood balance
   - Build structures:
     - `market`, `forge`, `temple`, `walls`
   - Introduce 2‚Äì3 `Character`:
     - `Governor` (ruler)
     - `High Priest`
     - `Master Artisan`
   - Create `KnowledgeField`: ‚Äú–ü–∏—Å—å–º–µ–Ω–Ω–æ—Å—Ç—å‚Äù, ‚Äú–ì–æ–Ω—á–∞—Ä–Ω–æ–µ –¥–µ–ª–æ‚Äù, ‚Äú–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞‚Äù
   - Create `EconomySnapshot` with taxes and first trade routes
4. Record a `WorldChronicle` entry:
   > ‚Äú–ù–∞—á–∞–ª–æ —ç–ø–æ—Ö–∏ –≥–æ—Ä–æ–¥–æ–≤. –ü–ª–µ–º–µ–Ω–∞ –ö–∞–≥–∞–Ω—å–∏ –∏ –ì—Ä–∞—Å—Ç—ã –≤–æ–∑–¥–≤–∏–≥–ª–∏ —Å—Ç–µ–Ω—ã, –≤–æ–∑–∂–≥–ª–∏ –æ—á–∞–≥–∏ —Ä–µ–º–µ—Å–µ–ª –∏ —Ç–æ—Ä–≥–æ–≤–ª–∏.‚Äù

5. Add 1‚Äì2 `Rumor` entries (e.g. ‚Äú–ì–æ–≤–æ—Ä—è—Ç, –∫—É–∑–Ω–µ—Ü—ã –ö–∞–≥–∞–Ω—å–∏ –Ω–∞—à–ª–∏ —Å–µ–∫—Ä–µ—Ç –∑–∞–∫–∞–ª–∫–∏ –∂–µ–ª–µ–∑–∞.‚Äù).

6. Log to console:  
   `"–≠–ø–æ—Ö–∞ —Ä–∞–Ω–Ω–∏—Ö —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–π —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞."`

---

### 2Ô∏è‚É£ Integrate into Program.cs
After `TribesGenesisService.InitializeAsync(...)`, add:
```csharp
await CivilizationGenesisService.InitializeAsync(app.Services.CreateScope().ServiceProvider.GetRequiredService<AppDb>());
```

This ensures initialization order:
```
World ‚Üí Nature ‚Üí Tribes ‚Üí Civilization
```

---

## ‚úÖ Acceptance Criteria
- [ ] `CivilizationGenesisService` exists and runs automatically after tribal generation.
- [ ] 2‚Äì3 tribes are converted into `city_state` factions.
- [ ] Each city gains population, economy, and buildings.
- [ ] Chronicle records the dawn of civilization.
- [ ] No duplicate data when restarting.
- [ ] Console output confirms success.

---

## üí° Optional (future)
Integrate with `EconomyAI`, `CraftAI`, and `FaithAI`:
- Automatically assign first trade routes.
- Initialize religion and rituals.
- Generate myths of ‚ÄúCity Founders‚Äù through LLM (`GenesisAI`).

---

## üßæ References
- `Imperium.Infrastructure/Setup/WorldGenesisService.cs`
- `Imperium.Infrastructure/Setup/TribesGenesisService.cs`
- `Imperium.Domain.Models.Faction`
- `Imperium.Domain.Models.Building`
- `Imperium.Domain.Models.WorldChronicle`
- `Imperium.Api/Program.cs`
