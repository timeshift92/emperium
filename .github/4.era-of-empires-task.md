
# üëë Copilot SWE Task ‚Äî Era of Empires Genesis

## üéØ Goal
Advance Imperium Universe from early city-states to **Era of Empires**.  
This phase introduces empires, diplomacy, armies, taxation systems, and codified laws ‚Äî laying the foundation of complex civilizations.

---

## üß© Architecture Context
Project structure (Aspire-style):
- `Imperium.Domain` ‚Äî domain models, agents, metrics
- `Imperium.Infrastructure` ‚Äî EF Core, setup, seeders
- `Imperium.Api` ‚Äî Minimal API, TickWorker, SignalR
- `Imperium.Llm` ‚Äî JSON-only LLM client

Depends on previous initializers:
- ‚úÖ `WorldGenesisService`
- ‚úÖ `NatureGenesisService`
- ‚úÖ `TribesGenesisService`
- ‚úÖ `CivilizationGenesisService`

Database: SQLite (EF Core)
Tick interval: 30 seconds

---

## üèóÔ∏è Tasks

### 1Ô∏è‚É£ Create `EmpireGenesisService`
File: `src/Imperium.Infrastructure/Setup/EmpireGenesisService.cs`

Implement static class:
```csharp
public static class EmpireGenesisService
{
    public static Task InitializeAsync(AppDb db, CancellationToken ct = default);
}
```

#### Logic:
1. Skip if any `Faction` of type `"empire"` already exists.
2. Identify 2‚Äì3 powerful city-states from the `CivilizationGenesisService` phase.
3. Merge neighboring city-states or annex smaller factions into early empires:
   - Example: "–î–æ–º –°–∏—Ä–∞–∫—É–∑" + "–ö–∞–≥–∞–Ω—å—è" ‚Üí "–ò–º–ø–µ—Ä–∏—è –°–∏—Ä–∞–∫—É–∑—Å–∫–∞—è"
   - Example: "–ì—Ä–∞—Å—Ç–∞" + "–ö–µ—Ç–∞–º–∏–∫–æ—Å" ‚Üí "–ì—Ä–∞—Å—Ç–∏–Ω—Å–∫–∏–π –°–æ—é–∑"
4. For each empire:
   - Create new `Faction` with `Type = "empire"` and set `ParentFactionId` for merged states.
   - Add `Army` entities (infantry, cavalry, archers, navy) with manpower and morale stats.
   - Create `LegalCode` entry (simple JSON for now, e.g. "Law of Markets", "Law of Tribute").
   - Create `TaxPolicy` JSON with trade and agriculture tax rates.
   - Generate `KnowledgeField`: ‚Äú–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ‚Äù, ‚Äú–í–æ–µ–Ω–Ω–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ‚Äù, ‚Äú–Æ—Ä–∏—Å–ø—Ä—É–¥–µ–Ω—Ü–∏—è‚Äù.
   - Add 1‚Äì2 `Character`: –ò–º–ø–µ—Ä–∞—Ç–æ—Ä, –í–µ—Ä—Ö–æ–≤–Ω—ã–π –ñ—Ä–µ—Ü, –°–æ–≤–µ—Ç–Ω–∏–∫.
   - Add new `Building`: –¥–≤–æ—Ä–µ—Ü, —Ñ–æ—Ä—É–º, –∞—Ä—Å–µ–Ω–∞–ª.
5. Record a `WorldChronicle` entry:
   > ‚Äú–ù–∞—Å—Ç–∞–ª–∞ –≠–ø–æ—Ö–∞ –ò–º–ø–µ—Ä–∏–π. –ì–æ—Ä–æ–¥—Å–∫–∏–µ –¥–µ—Ä–∂–∞–≤—ã –æ–±—ä–µ–¥–∏–Ω–∏–ª–∏—Å—å –≤ –ø–µ—Ä–≤—ã–µ –≤–µ–ª–∏–∫–∏–µ –¥–µ—Ä–∂–∞–≤—ã, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ –∑–∞–∫–æ–Ω—ã –∏ –∞—Ä–º–∏–∏.‚Äù

6. Add a few `Rumor` entries (e.g. ‚Äú–ò–º–ø–µ—Ä–∞—Ç–æ—Ä –°–∏—Ä–∞–∫—É–∑ –≥–æ–≤–æ—Ä–∏—Ç —Å –±–æ–≥–∞–º–∏.‚Äù).

7. Log to console:  
   `"–≠–ø–æ—Ö–∞ –ò–º–ø–µ—Ä–∏–π —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞."`

---

### 2Ô∏è‚É£ Integrate into Program.cs
After `CivilizationGenesisService.InitializeAsync(...)`, add:
```csharp
await EmpireGenesisService.InitializeAsync(app.Services.CreateScope().ServiceProvider.GetRequiredService<AppDb>());
```

This ensures initialization order:
```
World ‚Üí Nature ‚Üí Tribes ‚Üí Civilization ‚Üí Empires
```

---

## ‚úÖ Acceptance Criteria
- [ ] `EmpireGenesisService` exists and runs after civilization generation.
- [ ] 2‚Äì3 empires created, each with armies, economy, and laws.
- [ ] Merged factions reflect political unions.
- [ ] Chronicle and rumors describe the dawn of empires.
- [ ] Console confirms: `"–≠–ø–æ—Ö–∞ –ò–º–ø–µ—Ä–∏–π —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞."`
- [ ] Re-running app does not duplicate data.

---

## üí° Optional (future)
Integrate with `PoliticsAI`, `ConflictAI`, and `LegalAI v2`:
- Generate alliances and rivalries.
- Initialize empire laws and trade systems.
- Enable diplomacy events (wars, treaties, rebellions).

Future LLM expansion:  
`GenesisAI` generates imperial founding myths in JSON:
```json
{
  "empire_name": "–ò–º–ø–µ—Ä–∏—è –°–∏—Ä–∞–∫—É–∑—Å–∫–∞—è",
  "founding_myth": "–°–≤–µ—Ç –§–µ–±–∞ –æ—Å–≤–µ—Ç–∏–ª –∞–∫—Ä–æ–ø–æ–ª—å, –∫–æ–≥–¥–∞ —Ä–æ–¥–∏–ª—Å—è –ø–µ—Ä–≤—ã–π –∏–º–ø–µ—Ä–∞—Ç–æ—Ä...",
  "core_values": ["–ß–µ—Å—Ç—å", "–ú—É–¥—Ä–æ—Å—Ç—å", "–°–∏–ª–∞"]
}
```
‚Üí Stored into `WorldChronicle` as `"ImperialMyth"` event.

---

## üßæ References
- `Imperium.Infrastructure/Setup/CivilizationGenesisService.cs`
- `Imperium.Infrastructure/Setup/WorldGenesisService.cs`
- `Imperium.Domain.Models.Faction`
- `Imperium.Domain.Models.Army`
- `Imperium.Domain.Models.WorldChronicle`
- `Imperium.Api/Program.cs`
